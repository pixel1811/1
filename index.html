<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Pixeldrain Converter</title>
<style>
*{box-sizing:border-box}
body{
  margin:0;
  padding:8px;
  font-family:sans-serif;
  background:#fff;
}
h3,h4{margin:8px 0;font-size:15px}
textarea{
  width:100%;
  height:120px;
  padding:6px;
  font-size:14px;
}
button{
  width:100%;
  padding:10px;
  font-size:14px;
  margin:4px 0;
  border:none;
  border-radius:6px;
}
.convert{background:#007bff;color:#fff}
.restore{background:#6c757d;color:#fff}
.clear{background:#dc3545;color:#fff}

.card{
  border:1px solid #ddd;
  border-radius:8px;
  padding:8px;
  margin:6px 0;
  background:#f9f9f9;
}
.card.copied{
  background:#e6f7e6;
  border-color:#4caf50;
}
.link{
  font-size:13px;
  word-break:break-all;
  margin-bottom:6px;
}
.copy{
  background:#eee;
  color:#000;
}
.copy.copied{
  background:#4caf50;
  color:#fff;
}
</style>
</head>
<body>

<h3>Pixeldrain ‚Üí Download</h3>

<button class="restore" onclick="restoreOriginal()">–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–µ —Å—Å—ã–ª–∫–∏</button>

<textarea id="input" placeholder="–í—Å—Ç–∞–≤—å —Å—Å—ã–ª–∫–∏ (–ø–æ –æ–¥–Ω–æ–π –Ω–∞ —Å—Ç—Ä–æ–∫—É)"></textarea>
<button class="convert" onclick="convert()">–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å</button>

<h4>–°—Å—ã–ª–∫–∏ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è</h4>
<button class="clear" onclick="clearLinks()">–û—á–∏—Å—Ç–∏—Ç—å —Å—Å—ã–ª–∫–∏</button>
<div id="links"></div>

<script>
const TTL=24*60*60*1000;
const KEY_LINKS="pd_links";
const KEY_ORIG="pd_original";

loadLinks();

// ---------- –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ ----------
function convert(){
  const input=document.getElementById("input").value.trim();
  if(!input)return;

  const lines=input.split(/\n+/);
  saveOriginal(lines);

  const data=loadData(KEY_LINKS);

  lines.forEach(line=>{
    const m=line.match(/pixeldrain\.com\/u\/([a-zA-Z0-9]+)/);
    if(!m)return;
    const url=`https://pixeldrain.com/api/file/${m[1]}`;
    if(!data.find(i=>i.url===url)){
      data.unshift({url,copied:false,time:Date.now()});
    }
  });

  saveData(KEY_LINKS,data);
  renderLinks();
  document.getElementById("input").value="";
}

// ---------- —Ä–µ–Ω–¥–µ—Ä ----------
function renderLinks(){
  const box=document.getElementById("links");
  box.innerHTML="";
  const data=clean(loadData(KEY_LINKS));

  data.forEach(item=>{
    const card=document.createElement("div");
    card.className="card"+(item.copied?" copied":"");

    const link=document.createElement("div");
    link.className="link";
    link.textContent=item.url;

    const btn=document.createElement("button");
    btn.className="copy"+(item.copied?" copied":"");
    btn.textContent=item.copied?"‚úî –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ":"üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å";
    btn.onclick=()=>copy(item.url,btn,card);

    card.append(link,btn);
    box.appendChild(card);
  });

  saveData(KEY_LINKS,data);
}

// ---------- –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ ----------
function copy(url,btn,card){
  navigator.clipboard.writeText(url).then(()=>{
    const data=loadData(KEY_LINKS);
    const item=data.find(i=>i.url===url);
    if(item)item.copied=true;
    saveData(KEY_LINKS,data);
    renderLinks();
  });
}

// ---------- –æ—á–∏—Å—Ç–∫–∞ ----------
function clearLinks(){
  if(confirm("–£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Å—Å—ã–ª–∫–∏?")){
    localStorage.removeItem(KEY_LINKS);
    renderLinks();
  }
}

// ---------- –∏—Å—Ö–æ–¥–Ω—ã–µ ----------
function saveOriginal(lines){
  localStorage.setItem(KEY_ORIG,JSON.stringify({lines,time:Date.now()}));
}
function restoreOriginal(){
  const d=JSON.parse(localStorage.getItem(KEY_ORIG)||"{}");
  if(d.lines && Date.now()-d.time<TTL){
    document.getElementById("input").value=d.lines.join("\n");
  }else alert("–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —Å—Å—ã–ª–æ–∫");
}

// ---------- storage ----------
function loadLinks(){renderLinks()}
function loadData(k){return JSON.parse(localStorage.getItem(k)||"[]")}
function saveData(k,v){localStorage.setItem(k,JSON.stringify(v))}
function clean(d){return d.filter(i=>Date.now()-i.time<TTL)}
</script>

</body>
</html>
