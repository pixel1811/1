<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Pixeldrain Converter</title>
<style>
body{font-family:sans-serif;padding:10px;max-width:520px;margin:auto}
textarea{width:100%;height:130px;margin:6px 0;font-size:14px}
button{cursor:pointer;margin-bottom:6px}
h4{margin:10px 0 4px;font-size:15px}

.card{
  border:1px solid #ddd;
  border-radius:8px;
  padding:8px;
  margin:6px 0;
  background:#fafafa;
  transition:.2s;
}
.card.copied{
  background:#e6f7e6;
  border-color:#4caf50;
}
.link{
  font-size:13px;
  word-break:break-all;
  margin-bottom:6px;
}
.copy{
  width:100%;
  padding:6px;
  font-size:14px;
  border:1px solid #aaa;
  border-radius:6px;
  background:#eee;
}
.copy.copied{
  background:#4caf50;
  color:#fff;
  border-color:#4caf50;
}
.history .card{
  background:#f0f0f0;
  border-style:dashed;
}
.restore-btn{
  display:block;
  width:100%;
  padding:6px;
  margin-bottom:10px;
  background:#007bff;
  color:#fff;
  border:none;
  border-radius:6px;
  font-size:14px;
  cursor:pointer;
}
</style>
</head>
<body>

<h3>Pixeldrain ‚Üí Download</h3>

<!-- –∫–Ω–æ–ø–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏—Å—Ö–æ–¥–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ -->
<button class="restore-btn" onclick="restoreOriginal()">–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–µ —Å—Å—ã–ª–∫–∏</button>

<textarea id="input" placeholder="–í—Å—Ç–∞–≤—å —Å—Å—ã–ª–∫–∏ (–ø–æ –æ–¥–Ω–æ–π –Ω–∞ —Å—Ç—Ä–æ–∫—É)"></textarea>
<button onclick="convert()" style="width:100%;padding:8px">–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å</button>

<h4>–¢–µ–∫—É—â–∏–µ —Å—Å—ã–ª–∫–∏</h4>
<div id="links"></div>

<h4>–ò—Å—Ç–æ—Ä–∏—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π (24—á)</h4>
<div id="history" class="history"></div>

<script>
const TTL = 24*60*60*1000; // 24 —á–∞—Å–∞
const KEY = "pixeldrain_history";
const ORIG = "pixeldrain_original";

loadHistory();

// —Å–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –≤—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏
function saveOriginal(lines){
  const now = Date.now();
  localStorage.setItem(ORIG, JSON.stringify({lines,time:now}));
}

function restoreOriginal(){
  const data = JSON.parse(localStorage.getItem(ORIG)||'{"lines":[],"time":0}');
  const now = Date.now();
  if(now - data.time < TTL){
    document.getElementById("input").value = data.lines.join("\n");
  } else {
    alert("–ò—Å—Ö–æ–¥–Ω—ã–µ —Å—Å—ã–ª–∫–∏ —É—Å—Ç–∞—Ä–µ–ª–∏ (>24—á)");
  }
}

function convert(){
  const input=document.getElementById("input").value.trim();
  if(!input) return;

  const lines = input.split(/\n+/);
  const links=document.getElementById("links");

  // —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ö–æ–¥–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏
  saveOriginal(lines);

  // –ø–µ—Ä–µ–Ω–æ—Å —Ç–µ–∫—É—â–∏—Ö –∫–∞—Ä—Ç–æ—á–µ–∫ –≤ –∏—Å—Ç–æ—Ä–∏—é
  [...links.children].forEach(saveCard);
  links.innerHTML="";

  lines.forEach(line=>{
    const m=line.match(/pixeldrain\.com\/u\/([a-zA-Z0-9]+)/);
    if(!m) return;
    createCard(`https://pixeldrain.com/api/file/${m[1]}`, links, false);
  });

  document.getElementById("input").value="";
  renderHistory();
}

function createCard(url, container, copied){
  const card=document.createElement("div");
  card.className="card"+(copied?" copied":"");

  const link=document.createElement("div");
  link.className="link";
  link.textContent=url;

  const btn=document.createElement("button");
  btn.className="copy"+(copied?" copied":"");
  btn.textContent=copied?"‚úî –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ":"üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å";
  btn.onclick=()=>copy(url,btn,card);

  card.appendChild(link);
  card.appendChild(btn);
  container.appendChild(card);
}

function copy(url,btn,card){
  navigator.clipboard.writeText(url).then(()=>{
    btn.textContent="‚úî –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ";
    btn.classList.add("copied");
    card.classList.add("copied");
    saveCard(card,true);
    setTimeout(()=>{
      btn.textContent="üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å";
      btn.classList.remove("copied");
    },1200);
  });
}

// —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞—Ä—Ç–æ—á–∫—É –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏
function saveCard(card, copied){
  const url=card.querySelector(".link").textContent;
  const data = JSON.parse(localStorage.getItem(KEY)||"[]");
  const exists = data.find(d=>d.url===url);
  if(exists){ exists.copied=copied; exists.time=Date.now(); }
  else data.unshift({url:url,copied:copied,time:Date.now()});
  localStorage.setItem(KEY,JSON.stringify(cleanHistory(data)));
}

// –∑–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –∏ —Ä–µ–Ω–¥–µ—Ä
function loadHistory(){
  renderHistory();
  const cards = JSON.parse(localStorage.getItem(KEY)||"[]");
  const links=document.getElementById("links");
  cards.forEach(c=>createCard(c.url,links,c.copied));
}

function renderHistory(){
  const history=document.getElementById("history");
  history.innerHTML="";
  const data=JSON.parse(localStorage.getItem(KEY)||"[]").filter(i=>Date.now()-i.time<TTL).slice(0,50);
  localStorage.setItem(KEY,JSON.stringify(data));

  data.forEach(item=>{
    const card=document.createElement("div");
    card.className="card"+(item.copied?" copied":"");
    card.textContent=item.url;
    history.appendChild(card);
  });
}

// —Ñ–∏–ª—å—Ç—Ä 24 —á–∞—Å–∞
function cleanHistory(data){
  const now=Date.now();
  return data.filter(i=>now-i.time<TTL).slice(0,50);
}
</script>

</body>
</html>
